{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NewArticle</title>
</head>
<body>
    <!-- ÂºïÂÖ•Ôºöbootstrap5 -->
    <!-- Bootstrap5 Ê†∏ÂøÉ CSS Êñá‰ª∂ -->
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/5.1.1/css/bootstrap.min.css">
    <!--  popper.min.js Áî®‰∫éÂºπÁ™ó„ÄÅÊèêÁ§∫„ÄÅ‰∏ãÊãâËèúÂçï -->
    <script src="https://cdn.staticfile.org/popper.js/2.9.3/umd/popper.min.js"></script>
    <!-- ÊúÄÊñ∞ÁöÑ Bootstrap5 Ê†∏ÂøÉ JavaScript Êñá‰ª∂ -->
    <script src="https://cdn.staticfile.org/twitter-bootstrap/5.1.1/js/bootstrap.min.js"></script>

    <!-- ÂºïÂÖ•ÔºöjQureyÔºåpopperÔºåbootstrapÔºålayui -->
    <script src="{% static 'jquery/jquery-3.6.4.js' %}"></script>
    <script src="{% static 'layer/layui.js' %}"></script>

    <!-- GithubÊ†áÂáÜÁöÑMarkdownÈ£éÊ†º -->
    <link rel="stylesheet" href="{% static 'article/create/github-markdown-light.css' %}">
    <!-- Highlight.js‰ª£Á†ÅÈ´ò‰∫Æ: monokaiÈ£éÊ†º -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/monokai.min.css">
    <!-- Ëá™ÂÆö‰πâÊ†∑Âºè -->
    <link rel="stylesheet" href="{% static 'article/create/style.css' %}">
    {% include 'header.html' %}
    <!-- Â∑¶‰æßÁºñËæëÈ°µÈù¢ -->
    <form id="create-form" method="post" action="." enctype="multipart/form-data">
        <!-- DjangoÊèê‰æõÂÆâÂÖ®ËæìÂÖ• -->
        {% csrf_token %}

        <!-- Â∑¶‰æßÂØºËà™Ê†è -->
        <div id="menu-bar">
            <!-- ‰ΩøÁî®Â∑¶‰æßÂØºËà™ -->
            <div id="left-menu">
                <!-- ÊñáÁ´†Â±ûÊÄßËÆæÁΩÆ -->
                <button id="menu-btn" class="menu-btn" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasExample"
                    aria-controls="offcanvasExample" title="Settings">
                    ‚öô
                    <!-- <img class="svg" src="{% static 'article/svgs/settings.svg' %}"> -->
                </button>
                <div class="offcanvas offcanvas-start settings-page" tabindex="-1" id="offcanvasExample" aria-labelledby="offcanvasExampleLabel">
                    <div class="offcanvas-header">
                        <h5 class="offcanvas-title" id="offcanvasExampleLabel">Global Attrs for Article</h5>
                        <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                    </div>
                    <div class="offcanvas-body">
                        <!-- ÈÄâÂèñÊâÄÂ±ûÁõÆÂΩï -->
                        <div class="form-group">
                            <label for="category">Category</label>
                            <select class="form-control" id="category" name="category">
                                <option value="">(root)</option>
                                {% for category in categories %}
                                <option value="{{ category.id }}" {% if category.id == father %} selected {% endif %}>{{ category }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                        <!-- ËøΩÂä†Ê†áÁ≠æ -->
                        <div class="form-group">
                            <label for="tags">Tags</label>
                            <input type="text" class="form-control col-3" id="tags" name="tags">
                        </div>
                        <!-- Â°´ÂÜôÊ†áÈ¢ò -->
                        <div class="form-group">
                            <label for="title">Title</label>
                            <input type="text" class="form-control" id="title" name="title">
                        </div>
                    </div>
                </div>
            </div>
            <!-- Á°ÆËÆ§ÂàõÂª∫ÊñáÁ´† -->
            <button id="menu-btn" type="submit" class="menu-btn" title="Save">
                üíæ
                <!-- <img class="svg" src="{% static 'article/svgs/save.svg' %}"> -->
            </button>
            <!-- ËøîÂõûÊåâÈíÆ -->
            <button id="menu-btn" onclick="goBack()" type="button" class="menu-btn" title="Exit">
                üîô
                <!-- <img class="svg" src="{% static 'article/svgs/exit.svg' %}"> -->
            </button>
            <script>
                function goBack() {
                    window.history.back();
                }
            </script>
        </div>

        <!-- ÁºñËæëÊñáÁ´†‰∏ª‰Ωì -->
        <textarea id="editor" type="text" class="editor" name="body"></textarea>

        <!-- ‰∏≠ÈÉ®ÂèØÊãñÊãΩÂàÜÈöîÊ†è -->
        <div class="drag-bar"></div>

        <!-- Âè≥‰æßÈ¢ÑËßàÁïåÈù¢ -->
        <div id="preview" class="markdown-body"></div>
    </form>

    <!-- ÂêêÂè∏Ê∂àÊÅØ -->
    <div class="toast-container">
        <div class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <strong class="me-auto"></strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body"></div>
        </div>
        <!-- ÂêêÂè∏Ê∂àÊÅØÊ†áÈ¢òÊ†∑Âºè -->
        <style>
            .success {
                color: green;
            }
            .error {
                color: red;
            }
        </style>
        <!-- AjaxÁõëÂê¨ÔºöÂõûÂ∫îÂêêÂè∏Ê∂àÊÅØ -->
        <script>
            $(document).ready(function () {
                $('form').submit(function (event) {
                    event.preventDefault();
                    var form = $(this);
                    $.ajax({
                        type: form.attr('method'),
                        url: form.attr('action'),
                        data: form.serialize(),
                        // ÊàêÂäüÊÉÖÂÜµ‰∏ãÂºπÂá∫ÁöÑÂêêÂè∏Ê∂àÊÅØ
                        success: function (data) {
                            $('.me-auto').text("üòâSuccess!").removeClass("error").addClass("success");
                            $('.toast-body').text("Saved successfully");
                            $('.toast').toast('show');
                        },
                        // Â§±Ë¥•ÊÉÖÂÜµ‰∏ãÂºπÂá∫ÁöÑÂêêÂè∏Ê∂àÊÅØ
                        error: function (xhr, errmsg, err) {
                            if (xhr.status == 400) {
                                $('.me-auto').text("ü§°Error!").removeClass("success").addClass("error");
                                $('.toast-body').text("Please fill in all required fields.");
                                $('.toast').toast('show');
                            } else {
                                alert("Unexpected error!");
                            }
                        },
                    });
                });
            });
        </script>
    </div>

    <!-- Marked.jsÔºöÊèê‰æõmarkdown‚ÜíHTMLËΩ¨Êç¢ -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- Highlight.jsÔºöÊèê‰æõ‰ª£Á†ÅÂùóÈ´ò‰∫Æ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.min.js"></script>
    <!-- Ëá™ÂÆö‰πâJsËÑöÊú¨ -->
    <script src="{% static 'article/create/script.js' %}"></script>
</body>
</html>


